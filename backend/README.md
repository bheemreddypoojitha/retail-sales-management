# Backend â€“ Retail Sales Management System

A production-ready RESTful API for managing retail sales data, built using **Node.js**, **Express.js**, and **PostgreSQL (Supabase)**. Supports optimized search, multi-select filters, sorting, and pagination using clean dynamic SQL queries.

---

## ğŸš€ Tech Stack

- **Node.js** + **Express.js**
- **PostgreSQL** (Supabase)
- **pg** (node-postgres)
- Dynamic SQL Query Builder
- **Render** (Backend Deployment)

---

## ğŸ“Œ Core Features

### ğŸ” Search
- Full-text search using PostgreSQL `ILIKE`
- Works on:
  - Customer Name
  - Phone Number
- Case-insensitive
- Works alongside filters, sorting, and pagination

### ğŸ›ï¸ Filters (Multi-Select & Range)
Supports filtering by:
- **Customer Region**
- **Gender**
- **Age Range**
- **Product Category**
- **Tags**
- **Payment Method**
- **Date Range** (`startDate` / `endDate`)

âœ” Filters work independently  
âœ” Filters combine together  
âœ” Filters preserve search & sorting state

### â†•ï¸ Sorting
Available options:
- **Date** â€“ newest â†’ oldest
- **Quantity** â€“ highest â†’ lowest
- **Customer Name** â€“ A â†’ Z

Sorting always preserves active filters + search.

### ğŸ“„ Pagination
- **10 items per page**
- Next / Previous navigation
- Returns:
  - `totalRecords`
  - `totalPages`
  - `currentPage`
  - `hasNextPage`
  - `hasPrevPage`

---

## ğŸ”§ Environment Variables

Create a `.env` file inside the backend folder:
```env
DATABASE_URL=your_supabase_postgres_url
PORT=5000
```

For Render deployment:
```env
DATABASE_URL=postgres://your-render-supabase-url
PORT=10000
```

---

## ğŸ› ï¸ Setup & Local Development

### Install dependencies
```bash
npm install
```

### Setup Database
```bash
npm run setup-db
```

### Upload CSV Data (1M records)
```bash
npm run upload-csv
```

### Start the server
```bash
npm start
```

Your backend will run at:
```
http://localhost:5000
```

API base:
```
http://localhost:5000/api
```

---

## ğŸ“ Folder Structure
```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ salesRoutes.js
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ db.js
â”‚   â”‚   â””â”€â”€ dataService.js
â”‚   â””â”€â”€ scripts/
â”‚       â”œâ”€â”€ setupDatabase.js
â”‚       â””â”€â”€ uploadToPostgres.js
â”‚
â”œâ”€â”€ data/
â”‚   â””â”€â”€ sales_data.csv
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ README.md
â”œâ”€â”€ .gitignore
â””â”€â”€ .env
```

---

## ğŸ”— API Endpoints

### `GET /api/sales/data`

Fetches sales data with:
- Search
- Multi-select filtering
- Range filtering
- Sorting
- Pagination

#### Query Parameters

| Parameter | Description |
|-----------|-------------|
| `search` | Name/phone search |
| `region` | Array of regions |
| `gender` | Array of genders |
| `ageMin` / `ageMax` | Age range |
| `category` | Product categories |
| `tags` | Tags |
| `payment` | Payment methods |
| `startDate` / `endDate` | Date range |
| `sort` | `date` / `quantity` / `name` |
| `page` | Page number |

#### Example Request
```bash
GET /api/sales/data?search=john&region=North&sort=date&page=1
```

#### Example Response
```json
{
  "status": "success",
  "data": [
    {
      "Transaction ID": "TXN001",
      "Customer Name": "John Doe",
      "Date": "2024-01-15",
      ...
    }
  ],
  "count": 10
}
```

---

### `GET /api/sales/filters`

Returns all available filter options.

#### Example Response
```json
{
  "status": "success",
  "filters": {
    "customerRegions": ["North", "South", "East", "West"],
    "genders": ["Male", "Female"],
    "productCategories": ["Electronics", "Clothing"],
    "tags": ["Sale", "New", "Featured"],
    "paymentMethods": ["Credit Card", "Cash"],
    "orderStatuses": ["Completed", "Pending"],
    "deliveryTypes": ["Home Delivery", "Store Pickup"],
    "ageRange": {
      "min": 18,
      "max": 80
    }
  }
}
```

---

### `GET /health`

Health check endpoint.

#### Example Response
```json
{
  "status": "success",
  "message": "Retail Sales API is running",
  "timestamp": "2024-12-08T10:30:00.000Z",
  "database": "connected"
}
```

---

## ğŸ§  Dynamic SQL Query Logic

Example SQL generated by the backend:
```sql
SELECT * FROM sales
WHERE
  customer_name ILIKE '%john%'
  AND customer_region = ANY($1)
  AND gender = ANY($2)
  AND age BETWEEN $3 AND $4
ORDER BY date DESC
LIMIT 10
OFFSET 0;
```

âœ” Fully dynamic  
âœ” SQL injectionâ€“safe  
âœ” Clean structure  
âœ” Easy to add new filters

---
## Environment Variables

Create a .env file inside /backend:

DATABASE_URL=your_supabase_postgres_url
PORT=5000


## Render Deployment:

DATABASE_URL=postgres://your-render-supabase-url
PORT=10000

## Setup & Local Development
Install dependencies
npm install

Start Backend Server
npm start

Server runs at:

http://localhost:5000

API base URL:

http://localhost:5000/api
